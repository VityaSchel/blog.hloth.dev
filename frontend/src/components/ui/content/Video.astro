---
/**
 * Example usage:
 *
 * import testVideo from "./test.mp4";
 *
 * <Video src={testVideo}>Test</Video>
 */

import { getVideoDimensions } from "$lib/video-metadata-retriever";

interface Props {
	src: string;
	children?: Element;
	autoplay?: boolean;
	controls?: boolean;
	alt?: string;
}

let { src, autoplay = false, controls, alt } = Astro.props;

let { width, height } = await getVideoDimensions(src);
const aspectRatio = width / height;
---

<figure class="max-w-full">
	<video
		{src}
		class:list={[
			"mx-auto max-h-[500px]",
			{
				"h-auto w-full": aspectRatio > 680 / 500,
				"h-full w-auto": aspectRatio <= 680 / 500,
			},
		]}
		controls={controls ?? !autoplay}
		loop={controls === undefined ? autoplay : !controls}
		muted={autoplay}
		autoplay={autoplay}
		playsinline
		aria-label={alt}
		style={`aspect-ratio: ${aspectRatio};`}
	>
	</video>
	<figcaption>
		<slot />
	</figcaption>
</figure>
