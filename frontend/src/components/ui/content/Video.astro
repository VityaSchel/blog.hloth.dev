---
/**
 * Example usage:
 *
 * import testVideo from "./test.mp4";
 *
 * <Video src={testVideo}>Test</Video>
 */

import { getVideoDimensions } from "$lib/video-metadata-retriever";

interface Props {
	src: string;
	srcHevc?: string;
	children?: Element;
	autoplay?: boolean;
	controls?: boolean;
	alt?: string;
}

let { src, srcHevc, autoplay = false, controls, alt } = Astro.props;

let { width, height } = await getVideoDimensions(src);
const aspectRatio = width / height;
---

<figure class="max-w-full">
	<video
		class:list={[
			"mx-auto max-h-[500px]",
			{
				"h-auto w-full": aspectRatio > 680 / 500,
				"h-full w-auto": aspectRatio <= 680 / 500,
			},
		]}
		controls={controls ?? !autoplay}
		loop={controls === undefined ? autoplay : !controls}
		muted={autoplay}
		autoplay={autoplay}
		playsinline
		aria-label={alt}
		style={`aspect-ratio: ${aspectRatio};`}
	>
		{
			srcHevc !== undefined && (
				<>
					<source src={srcHevc} type="video/mp4; codecs=hvc1" />
					<source src={srcHevc} type="video/mp4; codecs=hev1.1.6.L93.B0" />
				</>
			)
		}
		<source src={src} />
		{alt ?? "Your browser does not support the video tag."}
	</video>
	{
		Astro.slots.default && (
			<figcaption>
				<slot />
			</figcaption>
		)
	}
</figure>
