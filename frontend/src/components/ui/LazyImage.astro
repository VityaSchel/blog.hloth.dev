---
import type { ComponentProps } from "astro/types";
import { Picture, getImage } from "astro:assets";

type Props = ComponentProps<typeof Picture> & {
	banner?: boolean;
	content?: boolean;
};

let {
	banner,
	class: className = "rounded-lg",
	content,
	...props
} = Astro.props;

const img = await getImage({ src: props.src, format: "jpeg" });

let aspectRatio: number | null = null;
if (banner) {
	aspectRatio = 1.625 / 1;
} else if (
	img.options.width !== undefined &&
	img.options.height !== undefined
) {
	aspectRatio = img.options.width / img.options.height;
}
---

<div
	class:list={[
		"img-container",
		{
			"max-h-[inherit]": content,
			"banner-clip overflow-clip relative h-auto w-full": banner,
			landscape: aspectRatio != null && aspectRatio > 1,
			portrait: aspectRatio != null && aspectRatio <= 1,
		},
	]}
	style={aspectRatio != null ? `aspect-ratio: ${aspectRatio};` : undefined}
>
	<!-- @ts-expect-error fucking astro  -->
	<Picture
		class:list={[
			{
				"object-contain h-full": content,
				"object-cover h-full w-full": banner,
			},
			"backdrop-blur-2xl in-[.full-bleed]:w-auto in-[.full-bleed]:h-full",
			className,
		]}
		densities={[1, 2]}
		formats={["avif", "webp"]}
		loading={props.priority ? "eager" : "lazy"}
		pictureAttributes={{
			style: "mask: inherit",
		}}
		{...props}
	/>
</div>
